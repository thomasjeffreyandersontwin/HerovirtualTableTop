/* vim: set sts=4 sw=4 et: */

/* Titan Icon
 * Copyright (C) 2013 Titan Network
 * All Rights Reserved
 *
 * This code is for educational purposes only and is not licensed for
 * redistribution in source form.
 */

enum {
    COHVAR_BINDS = 1,
    COHVAR_CAMERA,
    COHVAR_CAM_IS_DETACHED,
    COHVAR_CLASS_TBL,
    COHVAR_CONTROLS,
    COHVAR_CONTROLS_FROM_SERVER,
    COHVAR_DEFAULT_BINDS,
    COHVAR_EDIT_TRANSFORM_ABS,
    COHVAR_ENT_CHAR_OFFSET,
    COHVAR_ENT_DEMO_OFFSET,
    COHVAR_ENT_FLAGS_OFFSET,
    COHVAR_ENT_NEXT_MOV_OFFSET,
    COHVAR_ENT_SERVERID_OFFSET,
    COHVAR_ENT_TYPES,
    COHVAR_ENTTBL,
    COHVAR_GAME_TIME,
    COHVAR_GAME_TIME_STEP,
    COHVAR_MAP_ROOT,
    COHVAR_NPC_LIST,
    COHVAR_NOCOLL,
    COHVAR_PLAYER_ENT,
    COHVAR_PLAYER_KBOFFSET,
    COHVAR_ORIGIN_TBL,
    COHVAR_SEEALL,
    COHVAR_SCHEMA_COSTUME,
    COHVAR_START_CHOICE,
    COHVAR_TARGET,
    COHFUNC_ANNOYING_ALERT,
    COHFUNC_ARRAY_LOOKUP,
    COHFUNC_BACKSLASH_FIX,
    COHFUNC_BIN_CLEAR,
    COHFUNC_BIN_INIT,
    COHFUNC_BIN_LOADFILE,
    COHFUNC_BIND_PUSH,
    COHFUNC_BIND,
    COHFUNC_CALLOC,
    COHFUNC_CHKSTK,
    COHFUNC_CMD_INIT,
    COHFUNC_CMD_PARSE,
    COHFUNC_CLEAR_ENTS,
    COHFUNC_COSTUME_DIR,
    COHFUNC_COPY_ATTRIBS,
    COHFUNC_DETACH_CAMERA,
    COHFUNC_DIALOG,
    COHFUNC_DIALOG_GET_TEXT,
    COHFUNC_ENT_COSTUME_UPDATED,
    COHFUNC_ENT_FREE,
    COHFUNC_ENT_INITCHAR,
    COHFUNC_ENT_INITPLAYER,
    COHFUNC_ENT_MOVE,
    COHFUNC_ENT_NEW,
    COHFUNC_ENT_PREPARE_COSTUME,
    COHFUNC_ENT_SET_COSTUME,
    COHFUNC_ENT_SET_COSTUME_NPC_PTR,
    COHFUNC_ENT_SET_MATRIX,
    COHFUNC_ENT_TELEPORT,
    COHFUNC_FREE_ARRAY,
    COHFUNC_GET_CLASS,
    COHFUNC_GET_NPC_COSTUME_IDX,
    COHFUNC_GET_NPC_COSTUME_PTR,
    COHFUNC_GET_ORIGIN,
    COHFUNC_HASH_CLEAR,
    COHFUNC_HASH_CREATE,
    COHFUNC_HASH_FREE,
    COHFUNC_HASH_INSERT,
    COHFUNC_HASH_LOOKUP,
    COHFUNC_INIT_KEYBINDS,
    COHFUNC_LOAD_MAP_DEMO,
    COHFUNC_MAP_CLEAR,
    COHFUNC_MATRIX_FROM_PYR,
    COHFUNC_MATRIX_TO_PYR,
    COHFUNC_MOV_BY_NAME,
    COHFUNC_RAND,
    COHFUNC_STRCAT_S,
    COHFUNC_STRCPY,
    COHFUNC_TRANSLATE,
    COHFUNC_WALK_MAP,
    COH_END
};

typedef struct {
	int id;
	DWORD addr;
} addrmap;

static DWORD addrmap_cache[COH_END];

static addrmap addrs_i23[] = {
	{ COHVAR_BINDS, 0x00E35994 },
	{ COHVAR_CAMERA, 0x012DB2E0 },
	{ COHVAR_CLASS_TBL, 0x016870A0 },
	{ COHVAR_ORIGIN_TBL, 0x016870B4 },
	{ COHVAR_CONTROLS, 0x0166D5C0 },
	{ COHVAR_CONTROLS_FROM_SERVER, 0x00CAD0C8 },
	{ COHVAR_DEFAULT_BINDS, 0x01673900 },
	{ COHVAR_EDIT_TRANSFORM_ABS, 0x00DD5D0F },
	{ COHVAR_ENT_CHAR_OFFSET, 0x0E04 },
	{ COHVAR_ENT_DEMO_OFFSET, 0x1938 },
	{ COHVAR_ENT_FLAGS_OFFSET, 0x3248 },
	{ COHVAR_ENT_NEXT_MOV_OFFSET, 0x192c },
	{ COHVAR_ENT_SERVERID_OFFSET, 0x0F6c },
	{ COHVAR_ENT_TYPES, 0x012DEDC0 },
	{ COHVAR_ENTTBL, 0x012F2DE0 },
	{ COHVAR_GAME_TIME, 0x166D504 },
	{ COHVAR_MAP_ROOT, 0x00F76FE0 },
	{ COHVAR_NOCOLL, 0x166D64C },
	{ COHVAR_NPC_LIST, 0x016871A0 },
	{ COHVAR_PLAYER_ENT, 0x00CAD11C },
	{ COHVAR_PLAYER_KBOFFSET, 0x5AB8 },
	{ COHVAR_SEEALL, 0x1678DA8 },
	{ COHVAR_SCHEMA_COSTUME, 0x00BBEE00 },
	{ COHVAR_START_CHOICE, 0x00BB7600 },
	{ COHVAR_TARGET, 0x00F14150 },
	{ COHFUNC_ANNOYING_ALERT, 0x005C1870 },
	{ COHFUNC_BACKSLASH_FIX, 0x00856250 },
	{ COHFUNC_BIN_CLEAR, 0x00873830 },
	{ COHFUNC_BIN_INIT, 0x008737D0 },
	{ COHFUNC_BIN_LOADFILE, 0x00876530 },
	{ COHFUNC_BIND, 0x005C7AA0 },
	{ COHFUNC_BIND_PUSH, 0x005C7A10 },
	{ COHFUNC_CALLOC, 0x009D801C },
	{ COHFUNC_CHKSTK, 0x009E0440 },
	{ COHFUNC_CLEAR_ENTS, 0x0045EE70 },
	{ COHFUNC_CMD_INIT, 0x00868030 },
	{ COHFUNC_CMD_PARSE, 0x008679A0 },
	{ COHFUNC_COSTUME_DIR, 0x0071AEB0 },
	{ COHFUNC_COPY_ATTRIBS, 0x00495B10 },
	{ COHFUNC_DIALOG, 0x005B5490 },
	{ COHFUNC_DIALOG_GET_TEXT, 0x005B9410 },
	{ COHFUNC_ENT_COSTUME_UPDATED, 0x004575E0 },
	{ COHFUNC_ENT_FREE, 0x0045EF80 },
	{ COHFUNC_ENT_INITCHAR, 0x00495400 },
	{ COHFUNC_ENT_INITPLAYER, 0x004CD5F0 },
	{ COHFUNC_ENT_MOVE, 0x004B3050 },
	{ COHFUNC_ENT_NEW, 0x0045E340 },
	{ COHFUNC_ENT_PREPARE_COSTUME, 0x004B3CA0 },
	{ COHFUNC_ENT_SET_COSTUME, 0x004B3C20 },
	{ COHFUNC_ENT_SET_COSTUME_NPC_PTR, 0x004B3BD0 },
	{ COHFUNC_ENT_SET_MATRIX, 0x004B31C0 },
	{ COHFUNC_ENT_TELEPORT, 0x004B30B0 },
	{ COHFUNC_FREE_ARRAY, 0x008A2990 },
	{ COHFUNC_GET_CLASS, 0x004A7AF0 },
	{ COHFUNC_GET_NPC_COSTUME_IDX, 0x004CFD80 },
	{ COHFUNC_GET_NPC_COSTUME_PTR, 0x004CFCF0 },
	{ COHFUNC_GET_ORIGIN, 0x004BB610 },
	{ COHFUNC_HASH_CLEAR, 0x008598A0 },
	{ COHFUNC_HASH_CREATE, 0x008595D0 },
	{ COHFUNC_HASH_FREE, 0x00859740 },
	{ COHFUNC_HASH_INSERT, 0x0085A9A0 },
	{ COHFUNC_HASH_LOOKUP, 0x0085ABB0 },
	{ COHFUNC_INIT_KEYBINDS, 0x005C7720 },
	{ COHFUNC_LOAD_MAP_DEMO, 0x00534160 },
	{ COHFUNC_MATRIX_FROM_PYR, 0x0086F100 },
	{ COHFUNC_MATRIX_TO_PYR, 0x0086F510 },
	{ COHFUNC_MAP_CLEAR, 0x0053AAD0 },
	{ COHFUNC_MOV_BY_NAME, 0x00597F10 },
	{ COHFUNC_RAND, 0x009D871A },
	{ COHFUNC_STRCAT_S, 0x009DE48F },
	{ COHFUNC_STRCPY, 0x00849EF0 },
	{ COHFUNC_TRANSLATE, 0x00851620 },
	{ COHFUNC_WALK_MAP, 0x005498A0 },
	{ 0, 0 }

};

static addrmap addrs_i24[] = {
	{ COHVAR_BINDS, 0x00E37F64 },
	{ COHVAR_CAMERA, 0x012DF1A0 },
	{ COHVAR_CAM_IS_DETACHED, 0x016730C8 },
	{ COHVAR_CLASS_TBL, 0x0168A0A0 },
	{ COHVAR_ORIGIN_TBL, 0x0168A0B4 },
	{ COHVAR_CONTROLS, 0x01671420 },
	{ COHVAR_CONTROLS_FROM_SERVER, 0x00CAF538 },
	{ COHVAR_DEFAULT_BINDS, 0x01677760 },
	{ COHVAR_EDIT_TRANSFORM_ABS, 0x00DD7EFF },

	{ COHVAR_ENT_CHAR_OFFSET, 0x0E00 },
	{ COHVAR_ENT_DEMO_OFFSET, 0x1934 },		
	{ COHVAR_ENT_FLAGS_OFFSET, 0x3244 },	//xxx

	{ COHVAR_ENT_NEXT_MOV_OFFSET, 0x1928 },

	{ COHVAR_ENT_SERVERID_OFFSET, 0x0F68 },
	{ COHVAR_ENT_TYPES, 0x012E2C20 },
	{ COHVAR_ENTTBL, 0x012F6C40 },

	{ COHVAR_GAME_TIME, 0x01671364 },
	{ COHVAR_MAP_ROOT, 0x00F77E40 },
	{ COHVAR_NOCOLL, 0x016714AC },
	{ COHVAR_NPC_LIST, 0x0168A1A0 },
	{ COHVAR_PLAYER_ENT, 0x00CAF580 },

	{ COHVAR_PLAYER_KBOFFSET, 0x5Ac8 },
	{ COHVAR_SCHEMA_COSTUME, 0x00BC0F20 },
	{ COHVAR_SEEALL, 0x0167CC04 },
	{ COHVAR_START_CHOICE, 0x00BB95F4 },
	{ COHVAR_TARGET, 0x00F14FB0 },
	{ COHFUNC_ANNOYING_ALERT, 0x005C31C0 },
	{ COHFUNC_BACKSLASH_FIX, 0x00853850 },
	// esi: string (in and out)
	{ COHFUNC_BIN_CLEAR, 0x0086FF00 },
	// stack + 0: schema
	// stack + 4: struct
	{ COHFUNC_BIN_INIT, 0x0086FEA0 },
	// stack + 0: schema
	// stack + 4: struct
	{ COHFUNC_BIN_LOADFILE, 0x00872C00 },
	// stack + 00: dir
	// stack + 04: filename
	// stack + 08: unknown (0)
	// stack + 0C: flags
	// stack + 10: schema
	// stack + 14: output struct ptr
	// stack + 18: unknown (0)
	// stack + 1C: unknown (0)
	// stack + 20: unknown (0)
	{ COHFUNC_BIND, 0x005C93D0 },
	{ COHFUNC_BIND_PUSH, 0x005C9340 },
	{ COHFUNC_CALLOC, 0x009D630C },
	{ COHFUNC_CHKSTK, 0x009DE710 },
	{ COHFUNC_CLEAR_ENTS, 0x0045EF60 },
	{ COHFUNC_CMD_INIT, 0x008633C0 },
	{ COHFUNC_CMD_PARSE, 0x00862D30 },
	{ COHFUNC_COSTUME_DIR, 0x0071ADF0 },
	{ COHFUNC_COPY_ATTRIBS, 0x00495C90 },
	{ COHFUNC_DETACH_CAMERA, 0x004DF9E0 },
	{ COHFUNC_DIALOG, 0x005B6E10 },
	{ COHFUNC_DIALOG_GET_TEXT, 0x005BAD80 },
	{ COHFUNC_ENT_COSTUME_UPDATED, 0x004576D0 },
	// ecx: entity
	{ COHFUNC_ENT_FREE, 0x0045F070 },
	{ COHFUNC_ENT_INITCHAR, 0x00495870 },
	{ COHFUNC_ENT_INITPLAYER, 0x004CE3F0 },
	{ COHFUNC_ENT_MOVE, 0x004B3730 },
	{ COHFUNC_ENT_NEW, 0x0045E430 },
	{ COHFUNC_ENT_PREPARE_COSTUME, 0x004B4380 },
	// eax: costume
	// esi: entity
	{ COHFUNC_ENT_SET_COSTUME, 0x004B4300 },
	// eax: entity
	// edx: costume
	{ COHFUNC_ENT_SET_COSTUME_NPC_PTR, 0x004B42B0 },
	// stack + 0: costume *POINTER*
	// eax: entity
	{ COHFUNC_ENT_SET_MATRIX, 0x004B38A0 },
	// esi: entity
	// ecx: matrix (4x3)
	{ COHFUNC_ENT_TELEPORT, 0x004B3790 },
	{ COHFUNC_FREE_ARRAY, 0x008A0560 },
	{ COHFUNC_GET_CLASS, 0x004A7E60 },
	{ COHFUNC_GET_NPC_COSTUME_IDX, 0x004D0B80 },
	{ COHFUNC_GET_NPC_COSTUME_PTR, 0x004D0AF0 },
	// edx: npc costume index
	// esi: always 0? maybe subindex
	{ COHFUNC_GET_ORIGIN, 0x004BBDC0 },
	{ COHFUNC_HASH_CLEAR, 0x008552F0 },
	// eax: hash table
	{ COHFUNC_HASH_CREATE, 0x00855020 },
	// stack + 0: size hint
	// stack + 4: flags? 1 is used a lot
	// ecx: filename
	// edx: line number
	{ COHFUNC_HASH_FREE, 0x00855190 },
	// esi: hash table
	{ COHFUNC_HASH_INSERT, 0x008563F0 },
	// esi: hash table
	// stack + 0: pointer to key (string)
	// stack + 4: value
	// stack + 8: replace? (bool)
	{ COHFUNC_HASH_LOOKUP, 0x00856600 },
	// edi: pointer to hash table
	// stack + 0: pointer to key (string)
	{ COHFUNC_INIT_KEYBINDS, 0x005C9050 },
	{ COHFUNC_LOAD_MAP_DEMO, 0x00535650 },
	{ COHFUNC_MATRIX_FROM_PYR, 0x0086BD70 },
	{ COHFUNC_MATRIX_TO_PYR, 0x0086C180 },
	{ COHFUNC_MAP_CLEAR, 0x0053BFC0 },
	{ COHFUNC_MOV_BY_NAME, 0x00599710 },
	{ COHFUNC_RAND, 0x009D6A05 },
	{ COHFUNC_STRCAT_S, 0x009DC76F },
	// stack + 0: dest
	// stack + 4: size
	// stack + 8: source
	{ COHFUNC_STRCPY, 0x00847500 },
	{ COHFUNC_TRANSLATE, 0x0084EC20 },
	// eax: text
	{ COHFUNC_WALK_MAP, 0x0054AD90 },
	{ 0, 0 }
};

